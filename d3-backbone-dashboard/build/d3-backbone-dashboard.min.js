/*! d3-backbone-dashboard 2013-09-05 */
var app=app||{};!function(){"use strict";app.events=_.clone(Backbone.Events),app.select=function(a,b){app["selected"+a]=b,$(window).off("resize"),app.events.trigger("render:graph")},app.remove=function(a){app["selected"+a]="",$(window).off("resize"),app.events.trigger("render:graph")},app.updateIssues=function(){app.loading(),app.selectedReporter="",app.selectedAssignee="",$.when(app.issues.fetch()).then(function(){app.loaded(),$(window).off("resize"),app.events.trigger("render:graph"),app.events.trigger("render:selectors")})},app.loading=function(){$("#loading").css("opacity",.3)},app.loaded=function(){$("#loading").css("opacity",0)},app.postToUrl=function(a,b,c){c=c||"post";var d=document.createElement("form");$(d).attr("method",c).attr("action",a).attr("target","_blank");for(var e in b)if(b.hasOwnProperty(e))if(b[e]instanceof Array){var f=document.createElement("select");$(f).attr("type","select").attr("name",e).attr("multiple","multiple");for(var g in b[e]){var h=$("<option>");$(f).append(h),h.attr("value",b[e][g]).attr("selected","selected")}d.appendChild(f)}else{var f=document.createElement("input");$(f).attr("type","hidden").attr("name",e).attr("value",b[e]),d.appendChild(f)}document.body.appendChild(d),d.submit(),$(d).remove()},app.format=function(a){return a.name}}();var app=app||{};!function(){"use strict";app.Product=Backbone.Model.extend({}),app.Issue=Backbone.Model.extend({}),app.User=Backbone.Model.extend({})}();var app=app||{};!function(){"use strict";var a=Backbone.Collection.extend({model:app.Issue,url:"data.json",activeParams:function(){var a={};return app.selectedReporter&&(a.reporter=app.selectedReporter),app.selectedAssignee&&(a.assignee=app.selectedAssignee),a},active:function(){var a=Backbone.Collection.extend(),b=this.activeParams();return jQuery.isEmptyObject(b)?this:new a(this.where(b))},requiredForProduction:function(){var a=Backbone.Collection.extend(),b=this.activeParams();return b.requiredForProduction=1,new a(this.where(b))},requiredForConversion:function(){var a=Backbone.Collection.extend(),b=this.activeParams();return b.requiredForConversion=1,new a(this.where(b))},bugs:function(){var a=Backbone.Collection.extend(),b=this.activeParams();return b.bug=1,new a(this.where(b))}});app.issues=new a}();var app=app||{};!function(){"use strict";var a=Backbone.Collection.extend({model:app.User,initialize:function(){this.listenTo(app.issues,"all",this.resetList)},resetList:function(){this.reset(app.issues.pluck())},comparator:function(a){return a.get("name")}});app.users=new a}();var app=app||{};!function(){"use strict";app.AppView=Backbone.View.extend({initialize:function(){app.updateIssues(),app.loaded(),new app.SelectorView({el:"#assignee-selector",collection:app.users,title:"Assignee",placeholder:"All assignees"}),new app.SelectorView({el:"#reporter-selector",collection:app.users,title:"Reporter",placeholder:"All reporters"}),new app.RequiredForProductionView({el:"#required-for-production",title:"Required for Production"}),new app.RequiredForConversionView({el:"#required-for-conversion",title:"Required for Conversion"}),new app.BugsView({el:"#bugs",title:"Bugs"}),new app.AllIssuesView({el:"#all-items",title:"All Items"}),new app.ConfirmedView({el:"#confirmed",title:"Confirmation Status"}),new app.PriorityView({el:"#priority",title:"Priority (remaining only)"})}})}(jQuery);var app=app||{};!function(){"use strict";app.SelectorView=Backbone.View.extend({events:{"select2-selecting":"select","select2-removed":"remove"},initialize:function(a){this.placeholder=a.placeholder,this.title=a.title,this.template=_.template($("#selector-template").html()),this.$el.append(this.template({title:this.title})),this.listenTo(app.events,"render:selectors",this.render)},render:function(){var a=this,b=_.chain(app.issues.pluck(a.title.toLowerCase())).compact().union().sort().map(function(a){return{text:a,id:a}}).value();this.$('input[type="hidden"]').select2("val",""),this.$('input[type="hidden"]').select2({data:{results:b},placeholder:this.placeholder,allowClear:!0})},select:function(a){app.select(this.title,a.object.id)},remove:function(){app.remove(this.title)}})}();var app=app||{};!function(){"use strict";app.AbstractIssuesGraphView=Backbone.View.extend({initialize:function(a){this.title=a.title,this.chart=Strut.PieChart().straightenLabels(!0).margin({top:30,left:30,bottom:30,right:30}).labelColor("#FFF").color(["#61C270","#439CA8","#EC7575"]).customLabelEnter([".append('tspan').text(function(d){ return d.data.count; }).attr('y', -10);",".append('tspan').text(function(d){ return ' (' + d3.format('f')(100*(d.data.count / d3.sum(data, function(d) {return d.count;}))) + '%)'; }).attr('y', 10).attr('x',0);"]).customLabelUpdate([".select('tspan:nth-child(1)').text(function(d){ return d.data.count; });",".select('tspan:nth-child(2)').text(function(d){ return '(' + d3.format('f')(100*(d.data.count / d3.sum(data, function(d) {return d.count;}))) + '%)'; });"]).showLegend(!0).sliceClasses(["done","remainingAssigned","remainingUnassigned"]).emptyText("No issues for this product/version."),this.template=_.template($("#issues-graph-template").html()),this.$el.append(this.template({title:this.title})),this.listenTo(app.events,"render:graph",this.render)},getParams:function(a){var b={pid:app.selectedProduct,fixfor:app.selectedVersion};switch(a){case"done":b.resolution=[1,2];break;case"remainingAssigned":b.resolution=[-1,4],b.assigneeSelect="specificgroup",b.assignee="newapp_dev";break;case"remainingUnassigned":b.resolution=[-1,4],b.assigneeSelect="specificuser",b.assignee="jira_newapp_dev"}return app.selectedReporter&&(b.reporterSelect="specificuser",b.reporter=app.selectedReporter),app.selectedAssignee&&(b.assigneeSelect="specificuser",b.assignee=app.selectedAssignee),b},render:function(){var a=this,b=this.getData();d3.select(a.$(".chart")[0]).data([b]).call(a.chart),d3.select(a.el).selectAll(".arc").selectAll("path").on("mouseover",function(){d3.select(this).attr("cursor","pointer").style("stroke","#333").style("stroke-width","2px"),d3.select(a.el).select(".hover-message").style("opacity",1)}).on("mouseout",function(){d3.select(this).style("stroke-width","0px"),d3.select(a.el).select(".hover-message").style("opacity",0)}),$(window).on("resize",function(){a.chart.duration(0),d3.select(a.$(".chart")[0]).data([b]).call(a.chart),a.chart.duration(500)})}})}();var app=app||{};!function(){"use strict";app.AllIssuesView=app.AbstractIssuesGraphView.extend({getData:function(){var a={done:1},b={done:0,assigned:1},c={done:0,assigned:0};return[{category:"Done",count:app.issues.active().where(a).length},{category:"Remaining Assigned",count:app.issues.active().where(b).length},{category:"Remaining Unassigned",count:app.issues.active().where(c).length}]}})}();var app=app||{};!function(){"use strict";app.BugsView=app.AbstractIssuesGraphView.extend({getParams:function(a){var b=app.BugsView.__super__.getParams.call(this,a);return b.type=1,b},getData:function(){var a={done:1},b={done:0,assigned:1},c={done:0,assigned:0};return[{category:"Done",count:app.issues.bugs().where(a).length},{category:"Remaining Assigned",count:app.issues.bugs().where(b).length},{category:"Remaining Unassigned",count:app.issues.bugs().where(c).length}]}})}();var app=app||{};!function(){"use strict";app.ConfirmedView=app.AbstractIssuesGraphView.extend({initialize:function(a){app.ConfirmedView.__super__.initialize.call(this,a),this.chart.sliceClasses(["confirmed","unconfirmed"])},getParams:function(a){var b=app.ConfirmedView.__super__.getParams.call(this,a);switch(a){case"confirmed":b.status=[6];break;case"unconfirmed":b.status=[5],b.resolution=[1,2]}return b},getData:function(){return[{category:"Confirmed",count:app.issues.active().where({status:6}).length},{category:"Unconfirmed",count:app.issues.active().where({status:5,done:1}).length}]}})}();var app=app||{};!function(){"use strict";app.PriorityView=app.AbstractIssuesGraphView.extend({initialize:function(a){app.PriorityView.__super__.initialize.call(this,a),this.chart.sliceClasses(["urgent","high","medium","low","niceToHave"]).color(["#EC7575","#e7969c","#6baed6","#439CA8","#61C270"])},getParams:function(a){var b=app.PriorityView.__super__.getParams.call(this,a);switch(b.resolution=[-1,4],a){case"urgent":b.priority=[1];break;case"high":b.priority=[2];break;case"medium":b.priority=[3];break;case"low":b.priority=[4];break;case"niceToHave":b.priority=[5]}return b},getData:function(){return[{category:"Urgent",count:app.issues.active().where({priority:1,done:0}).length},{category:"High",count:app.issues.active().where({priority:2,done:0}).length},{category:"Medium",count:app.issues.active().where({priority:3,done:0}).length},{category:"Low",count:app.issues.active().where({priority:4,done:0}).length},{category:"Nice to Have",count:app.issues.active().where({priority:5,done:0}).length}]}})}();var app=app||{};!function(){"use strict";app.RequiredForConversionView=app.AbstractIssuesGraphView.extend({getParams:function(a){var b=app.RequiredForConversionView.__super__.getParams.call(this,a);return b.customfield_10080="Required for Conversion",b},getData:function(){var a={done:1},b={done:0,assigned:1},c={done:0,assigned:0};return[{category:"Done",count:app.issues.requiredForConversion().where(a).length},{category:"Remaining Assigned",count:app.issues.requiredForConversion().where(b).length},{category:"Remaining Unassigned",count:app.issues.requiredForConversion().where(c).length}]}})}();var app=app||{};!function(){"use strict";app.RequiredForProductionView=app.AbstractIssuesGraphView.extend({getParams:function(a){var b=app.RequiredForProductionView.__super__.getParams.call(this,a);return b.customfield_10080="Required for Production",b},getData:function(){var a={done:1},b={done:0,assigned:1},c={done:0,assigned:0};return[{category:"Done",count:app.issues.requiredForProduction().where(a).length},{category:"Remaining Assigned",count:app.issues.requiredForProduction().where(b).length},{category:"Remaining Unassigned",count:app.issues.requiredForProduction().where(c).length}]}})}();var app=app||{};$(function(){"use strict";new app.AppView});